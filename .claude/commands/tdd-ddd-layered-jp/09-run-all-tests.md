すべてのテストを実行し、包括的なテストレポートを生成します。

以下の手順に従ってください：

1. **引数の確認**:

   - `$ARGUMENTS`が提供されていることを確認
   - 提供されていない場合は直ちに終了し、イシュー番号引数を渡すように日本語でユーザーに促す

2. **テスト環境のクリア**:

   - テストキャッシュをクリア: `pytest --cache-clear`
   - 古いカバレッジデータを除去: `rm -f .coverage`

3. **ユニットテストの実行**:

   ```bash
   pytest tests/unit/ -v --tb=short
   ```

   - すべてのドメインロジックテストが成功することを確認
   - ユースケーステストをチェック
   - 高速実行を確保（テストあたリ 1 秒未満）

4. **統合テストの実行**:

   ```bash
   pytest tests/integration/ -v --tb=short
   ```

   - リポジトリ実装をテスト
   - データベース操作を検証
   - 外部サービス連携をチェック

5. **E2E テストの実行**:

   ```bash
   pytest tests/e2e/ -v --tb=short
   ```

   - 完全なユーザーシナリオをテスト
   - API エンドポイントを検証
   - エラーハンドリングをチェック

6. **カバレッジレポートの生成**:

   ```bash
   pytest --cov=domain --cov=application --cov=infrastructure --cov=presentation \
          --cov-report=html --cov-report=term-missing \
          --cov-fail-under=80
   ```

   - カバレッジパーセンテージをレビュー
   - テストされていないコードパスを特定
   - HTML レポートを開く: `open htmlcov/index.html`

7. **パフォーマンステストの実行**（利用可能な場合）:

   ```bash
   pytest tests/performance/ -v --benchmark-only
   ```

   - レスポンス時間をチェック
   - ボトルネックを特定

8. **静的コード分析**:

   ```bash
   # リンティング
   ruff check . --statistics

   # タイプチェック
   pyright --stats

   # セキュリティスキャン（banditがインストールされている場合）
   bandit -r domain/ application/ infrastructure/ presentation/
   ```

9. **テストサマリーレポートの生成**:
   `docs/test_report/issue-$ARGUMENTS-test-report.md`にレポートを作成:

   ```markdown
   # テストレポート: <機能名>

   Issue: #$ARGUMENTS
   実行日時: <タイムスタンプ>

   ## テスト結果サマリー

   ### ユニットテスト

   - 実行数: X
   - 成功: X
   - 失敗: X
   - スキップ: X
   - 実行時間: X 秒

   ### 統合テスト

   - 実行数: X
   - 成功: X
   - 失敗: X
   - 実行時間: X 秒

   ### E2E テスト

   - 実行数: X
   - 成功: X
   - 失敗: X
   - 実行時間: X 秒

   ## カバレッジ

   - 全体: X%
   - ドメイン層: X%
   - アプリケーション層: X%
   - インフラ層: X%
   - プレゼンテーション層: X%

   ## 品質メトリクス

   - Ruff エラー: X
   - Pyright エラー: X
   - 循環的複雑度: 最大 X

   ## 推奨事項

   - <改善点 1>
   - <改善点 2>
   ```

10. **テスト品質のチェック**:

- テストが独立していることを確認
- ハードコードされたテストデータがないことを確認
- 適切なモックが行われていることをチェック
- アサーションメッセージを検証

11. **パフォーマンスベースライン**:

    - 現在のパフォーマンスメトリクスを記録
    - 将来の比較のためのベンチマークを設定

12. **イシューの更新**:

    - テストサマリーでコメント
    - カバレッジパーセンテージを含める
    - 懸念がある場合は注記

13. **次のステップの案内**:
    日本語で表示:

    ```
    テスト実行完了！

    結果:
    - ユニットテスト: X/X 成功
    - 統合テスト: X/X 成功
    - E2Eテスト: X/X 成功
    - カバレッジ: X%

    詳細レポート: docs/test_report/issue-X-test-report.md
    ```

重要な注意事項:

- テストを分離して実行（初期は並列実行しない）
- 不安定なテストは直ちに修正
- 80%以上のコードカバレッジを目標とする
- パフォーマンステストはオプション
- すべてのユーザー向け出力は日本語で行う必要があります
