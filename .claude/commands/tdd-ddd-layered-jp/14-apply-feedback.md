TDD/DDD/レイヤードアーキテクチャ実装にレビューフィードバックを適用します。

以下の手順に従います：

1. **引数の確認**：
   - `$ARGUMENTS`が提供されていることを確認
   - 提供されていない場合は即座に終了し、イシュー番号引数を渡すようユーザーに日本語で促す

2. **レビューレポートの読み込み**：
   - `docs/review/issue-$ARGUMENTS-review.md`からレビューレポートを読み取り
   - 見つからない場合は、先に`/review-issue`を実行するようユーザーに促す
   - 優先度別に改善項目を抽出

3. **現在のテスト状況の確認**：
   ```bash
   pytest --tb=short
   ```
   - 変更開始前にすべてのテストがGREENであることを確認
   - 現在のカバレッジ率を記録

4. **必須改善項目の処理**：
   
   各必須改善項目に対して：
   
   a. **集中テストの作成**：
      - 改善項目に特化したテストを作成
      - テストが最初に失敗することを確認（RED）
   
   b. **修正の実装**：
      - テストを通すための最小限の変更を実施（GREEN）
      - 変更を単一イシューに集中
   
   c. **テストの確認**：
      - 関連テストスイートを実行
      - 回帰がないことを確認

5. **推奨改善項目の処理**：
   
   各推奨改善項目に対して：
   
   a. **影響の評価**：
      - 労力と利益のバランスを評価
      - パブリックAPIに影響するかチェック
   
   b. **改善の適用**：
      - 機能追加の場合はTDDサイクルに従う
      - 既存コード改善の場合はリファクタリング
   
   c. **ドキュメントの更新**：
      - 影響を受ける設計ドキュメントを更新
      - 複雑度が増した場合はコメントを追加

6. **アーキテクチャ準拠の修正**：

   **DDDの原則**：
   - ユビキタス言語の不整合を修正
   - 必要に応じて集約境界を調整
   - ドメインの純粋性を確保（ドメインからI/Oを除去）
   - 値オブジェクトを真にイミュータブルにする

   **レイヤードアーキテクチャ**：
   - 依存関係方向の違反を修正
   - 循環依存を除去
   - 適切な関心の分離を確保
   - 不足している箇所に依存性注入を適用

   **TDDプラクティス**：
   - 不足しているテストシナリオを追加
   - テスト名と構造を改善
   - 重要なパスのカバレッジを向上

7. **コード品質の改善**：
   
   ```bash
   # リンティング問題の修正
   ruff check . --fix
   
   # 型チェックエラーの対処
   pyright
   
   # コードフォーマット
   ruff format .
   ```

8. **パフォーマンス最適化**（言及されている場合）：
   - 最適化前にプロファイリング
   - 改善の適用
   - 影響の測定
   - 変更の文書化

9. **テストの更新**：
   - レビューで発見されたエッジケースのテストを追加
   - テストデータビルダーの改善
   - テストの重複を除去
   - Given-When-Then構造を確保

10. **追加要件の新規チケット作成**（ある場合）：
    - レビュー中に新しい要件が発見された場合：
    
    a. **スプリント割り当ての決定**：
       - 現在のスプリント容量をチェック
       - 緊急性と依存関係に基づく優先度付け
    
    b. **GitHubイシューの作成**：
       ```bash
       # レビュー中に発見された新しいシナリオ
       gh issue create \
         --title "実装: <New requirement>" \
         --body "## 概要\n<Description>\n\n## 発見経緯\nIssue #$ARGUMENTS のレビュー中に発見\n\n## シナリオ\n- Given: <condition>\n- When: <action>\n- Then: <result>\n\n## 関連\n- 元Issue: #$ARGUMENTS\n- レビューレポート: docs/review/issue-$ARGUMENTS-review.md" \
         --label "enhancement,from-review"
       ```
    
    c. **スプリントバックログの更新**：
       - 現在のスプリント用: `docs/sprints/sprint-<current>-backlog.md`を更新
       - 次のスプリント用: `docs/sprints/sprint-<next>-backlog.md`を更新
    
    d. **シナリオドキュメントの作成**：
       - ファイル: `docs/use_cases/evolved/from-review-$ARGUMENTS-<aspect>.md`
       - 元のイシューとレビューレポートにリンク

11. **完全検証の実行**：
    ```bash
    # すべてのテストを実行
    pytest
    
    # カバレッジ改善をチェック
    pytest --cov=domain --cov=application --cov=infrastructure --cov=presentation \
           --cov-report=term-missing
    
    # コード品質を確認
    ruff check .
    pyright
    ```

12. **フィードバック適用レポートの作成**：
    `docs/review/issue-$ARGUMENTS-feedback-applied.md`を日本語で作成：

```markdown
# フィードバック反映レポート: <機能名>

Issue: #$ARGUMENTS
反映日時: <timestamp>
元レビュー: docs/review/issue-$ARGUMENTS-review.md

## 反映結果サマリー

### 必須対応項目
| 項目 | 対応状況 | 変更内容 |
|------|---------|----------|
| <改善点1> | ✅ 完了 | <具体的な変更> |
| <改善点2> | ✅ 完了 | <具体的な変更> |

### 推奨改善項目
| 項目 | 対応状況 | 変更内容/未対応理由 |
|------|---------|-------------------|
| <改善点1> | ✅ 完了 | <具体的な変更> |
| <改善点2> | ⏸️ 保留 | <未対応の理由> |

## メトリクス改善

| メトリクス | 改善前 | 改善後 | 変化 |
|-----------|--------|--------|------|
| テストカバレッジ | X% | Y% | +Z% |
| テスト数 | X | Y | +Z |
| 循環的複雑度（最大） | X | Y | -Z |
| Ruffエラー | X | 0 | -X |
| Pyrightエラー | X | 0 | -X |

## 主な変更点

### ドメイン層
- <変更内容1>
- <変更内容2>

### アプリケーション層
- <変更内容1>
- <変更内容2>

### インフラストラクチャ層
- <変更内容1>
- <変更内容2>

### プレゼンテーション層
- <変更内容1>
- <変更内容2>

## 追加されたテスト
- <テストケース1>: <カバーするシナリオ>
- <テストケース2>: <カバーするシナリオ>

## リファクタリング
- <リファクタリング1>: <改善内容>
- <リファクタリング2>: <改善内容>

## 新規作成チケット
| Issue # | タイトル | スプリント | 優先度 |
|---------|----------|------------|--------|
| #<new1> | <Title> | Sprint X | High |
| #<new2> | <Title> | Sprint Y | Medium |

## 残課題
- <将来的な改善案1>
- <将来的な改善案2>

## 最終確認
- [x] すべてのテストがGREEN
- [x] カバレッジ80%以上
- [x] Ruffエラーなし
- [x] Pyrightエラーなし
- [x] Given-When-Thenシナリオ完全実装
```

13. **イシューの更新**：
    ```bash
    gh issue comment $ARGUMENTS --body "レビューフィードバックを反映しました。

    反映結果:
    - 必須項目: X/X 完了
    - 推奨項目: Y/Z 完了
    - テストカバレッジ: X% → Y%
    
    詳細: docs/review/issue-$ARGUMENTS-feedback-applied.md
    
    すべてのテストがGREENで、品質基準を満たしています。"
    ```

14. **変更のコミット**：
    ```bash
    git add .
    git commit -m "refactor: レビューフィードバックを反映 (#$ARGUMENTS)

    - 必須改善項目をすべて対応
    - テストカバレッジを X% から Y% に改善
    - コード品質基準を達成
    
    詳細は docs/review/issue-$ARGUMENTS-feedback-applied.md を参照"
    ```

15. **サマリーの表示**：
    日本語でサマリーを表示：
    ```
    フィードバック反映完了！
    
    Issue: #$ARGUMENTS
    
    改善結果:
    - 必須項目: X/X ✅
    - 推奨項目: Y/Z ✅
    - 保留項目: Z件
    - 新規チケット作成: N件
    
    品質メトリクス:
    - カバレッジ: X% → Y% (↑Z%)
    - エラー: すべて解消 ✅
    
    次のステップ:
    - /run-all-tests $ARGUMENTS - 最終テスト実行
    - /create-pr $ARGUMENTS - プルリクエスト作成
    ```

重要な注意事項：
- 変更中は常にGREENテストを維持
- 一度に一つの改善を適用
- 特定の推奨事項が適用されなかった理由を文書化
- TDD/DDD/レイヤードアーキテクチャの原則の維持に集中
- すべての出力とドキュメントは日本語で記述