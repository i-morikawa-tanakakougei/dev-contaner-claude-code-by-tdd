包括的な GitHub issue コメント分析を含むアクティブな Git worktree の現在の変更に基づいてプルリクエストを作成してください。

クローズする issue: $ARGUMENTS （カンマ区切りの issue 番号）

以下の手順に従ってください:

1.  **引数の存在確認**

    - `$ARGUMENTS` が提供されているかを確認する。
    - `$ARGUMENTS` が指定されていない場合は、即座にプロセスを終了する。
    - 終了時は、ユーザーに issue 番号の引数を渡すよう促す。

2.  **各 issue の包括的分析**:
    - $ARGUMENTS をカンマ区切りの issue 番号として解析する
    - 各 issue 番号について:
      - `gh issue view` を使用してタイトル、説明、ラベルを含む issue の詳細を取得する
      - `gh api repos/:owner/:repo/issues/$ISSUE_NUMBER/comments` を使用して issue のすべてのコメントを取得する
      - 会話スレッド全体を分析して以下を理解する:
        - 元の問題提起
        - コメント内の明確化や追加要求
        - 技術的な議論と提案された解決策
        - 言及された実装の決定や変更
        - 実装アプローチに関する最終的な合意

3.  **現在の Worktree 変更の確認**

    - `git status` を使用して現在の worktree のステータスを確認する
    - `git diff origin/main` を使用して現在の worktree のブランチと `main` ブランチを比較する
    - PR に含めるステージまたは未ステージの変更があることを確認する
    - 変更が見つからない場合は、エラーメッセージと共に終了する
    - 変更が issue ディスカッションの最終的な合意と一致していることを検証する

4.  **Worktree でのブランチ準備**

    - `git rev-parse --abbrev-ref HEAD` を使用して worktree の現在のブランチを特定する
    - `git add .` ですべての変更をステージする
    - 変更を要約するメッセージでコミットする（例：「issues #$ARGUMENTS の変更を実装」）
    - `git push origin <現在のブランチ>` を使用してブランチをリモートリポジトリにプッシュする

5.  **プルリクエストの作成**

    - `gh pr create` を使用してプルリクエストを作成し、以下を含める:
      - 変更を要約する明確なタイトル（例：「issues #$ARGUMENTS の修正を実装」）
      - すべての issue に基づく適切なラベル（例：`bug`、`feature`、`enhancement`）
      - 必要に応じて新しいラベルを作成する
      - 現在のブランチをソース、`main` をターゲットブランチとして使用する
      - 包括的な説明で以下を含む:
        - 何が変更されたかの要約
        - issue コメントからの重要な決定の参照
        - $ARGUMENTS の各 issue に対して "Closes #<issue_number>" を含める
        - コメントで議論された重要な実装の詳細の言及

6.  **PR 説明の形式**
    - 変更内容の要約を含める
    - 説明は常に日本語で書く
    - コメントからの重要なアーキテクチャの決定や実装アプローチを参照する
    - コメントに具体的な技術的ガイダンスが含まれている場合は、実装ノートを含める
    - 各 issue に対して "Closes #<issue_number>" ステートメントを含める（$ARGUMENTS から解析）
    - 例: $ARGUMENTS が "123,456" の場合、説明に "Closes #123" と "Closes #456" を含める

**このコマンドの主要機能**:
- **Worktree 認識**: 現在の Git worktree とそのブランチで具体的に動作する
- **完全な issue コンテキスト**: 元の説明だけでなく、各 issue のすべてのコメントを分析する
- **実装の検証**: 変更が issue ディスカッションの最終的な合意と一致することを確認する
- **包括的な PR 説明**: issue コメントからの重要な決定とコンテキストを含める
- **複数 issue の処理**: $ARGUMENTS にリストされたすべての issue のコメントを分析する

注意:
- $ARGUMENTS をカンマ区切りの issue 番号として解析する
- PR がマージされたときに issue を自動的にクローズするため "Closes #<number>" 形式を使用する
- 現在の worktree のブランチと `main` ブランチの比較に基づいて PR を作成する
- `gh` CLI が設定され認証されていることを確認する
- 適切なラベルが存在しない場合は新しいラベルを作成する
- PR 説明に issue コメントからの重要なコンテキストを含める